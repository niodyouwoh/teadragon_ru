# üîß –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º—ã —Å S3 –Ω–∞ Vercel

## üìã –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ:

1. **–î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –≤ `/api/upload`
2. **–¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞** `/test-upload` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è** –ø–µ—Ä–µ–¥ –∑–∞–≥—Ä—É–∑–∫–æ–π

---

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel

–ó–∞–π–¥–∏—Ç–µ –≤ Vercel ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç ‚Üí **Settings** ‚Üí **Environment Variables**

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –µ—Å—Ç—å –í–°–ï —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:

```
S3_ENDPOINT=https://s3.twcstorage.ru
S3_REGION=ru-1
S3_BUCKET=d0bb84a6-35788b9e-6ba9-47ec-a1a8-68e9ea3ac4e9
S3_ACCESS_KEY=31MKAB1U3N1GEZSPJ09K
S3_SECRET_KEY=QloZiMNHPwJJPST1ShXZLnq4TS77FLMkNfLngSD4
```

**–í–ê–ñ–ù–û:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ –≤—Å–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏—è–º (Production, Preview, Development)
- –ü–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û —Å–¥–µ–ª–∞–π—Ç–µ Redeploy!

### –®–∞–≥ 2: Redeploy –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤–æ –≤–∫–ª–∞–¥–∫—É **Deployments**
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π –¥–µ–ø–ª–æ–π
3. –ù–∞–∂–º–∏—Ç–µ —Ç—Ä–∏ —Ç–æ—á–∫–∏ (...) ‚Üí **Redeploy**
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

**–ë–µ–∑ Redeploy –Ω–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—Ç—Å—è!**

### –®–∞–≥ 3: –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ:
```
https://–≤–∞—à-—Å–∞–π—Ç.vercel.app/test-upload
```

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ.

### –®–∞–≥ 4: –°–º–æ—Ç—Ä–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

#### ‚úÖ –ï—Å–ª–∏ —É—Å–ø–µ—à–Ω–æ:
- –£–≤–∏–¥–∏—Ç–µ –∑–µ–ª–µ–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
- URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è

#### ‚ùå –ï—Å–ª–∏ –æ—à–∏–±–∫–∞:
- –£–≤–∏–¥–∏—Ç–µ –∫—Ä–∞—Å–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–µ—Ç–∞–ª—è–º–∏
- –ö–æ–¥ –æ—à–∏–±–∫–∏
- –ü–æ–¥—Å–∫–∞–∑–∫—É —á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ Vercel

–ï—Å–ª–∏ –æ—à–∏–±–∫–∞, –æ—Ç–∫—Ä–æ–π—Ç–µ –ª–æ–≥–∏:

1. Vercel Dashboard ‚Üí –í–∞—à –ø—Ä–æ–µ–∫—Ç
2. –í–∫–ª–∞–¥–∫–∞ **Deployments**
3. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∞–∫—Ç–∏–≤–Ω—ã–π –¥–µ–ø–ª–æ–π
4. –í–∫–ª–∞–¥–∫–∞ **Functions**
5. –ù–∞–π–¥–∏—Ç–µ `/api/upload`
6. –°–º–æ—Ç—Ä–∏—Ç–µ –ª–æ–≥–∏

–ò—â–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏:
```
üîß S3 Config: { ... }
‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è: ...
```

---

## üêõ –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "S3 –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω"
**–ü—Ä–∏—á–∏–Ω–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–æ–±–∞–≤—å—Ç–µ –≤—Å–µ S3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ Vercel
2. –°–¥–µ–ª–∞–π—Ç–µ Redeploy

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "InvalidAccessKeyId"
**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–ª—é—á–∏ –¥–æ—Å—Ç—É–ø–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `S3_ACCESS_KEY` –∏ `S3_SECRET_KEY`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–µ –∫–ª—é—á–∏:
   - Access: `31MKAB1U3N1GEZSPJ09K`
   - Secret: `QloZiMNHPwJJPST1ShXZLnq4TS77FLMkNfLngSD4`

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "SignatureDoesNotMatch"
**–ü—Ä–∏—á–∏–Ω–∞:** Secret Key –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏–ª–∏ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–¥–∞–ª–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `S3_SECRET_KEY` –≤ Vercel
2. –î–æ–±–∞–≤—å—Ç–µ –∑–∞–Ω–æ–≤–æ (—Å–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ—á–Ω–æ):
   ```
   QloZiMNHPwJJPST1ShXZLnq4TS77FLMkNfLngSD4
   ```
3. Redeploy

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –Ω–æ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è
**–ü—Ä–∏—á–∏–Ω–∞:** Bucket –Ω–µ –ø—É–±–ª–∏—á–Ω—ã–π –∏–ª–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –≤ –ª–æ–≥–∞—Ö
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å URL –Ω–∞–ø—Ä—è–º—É—é –≤ –±—Ä–∞—É–∑–µ—Ä–µ
3. –ï—Å–ª–∏ 403 - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—É–±–ª–∏—á–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ bucket

---

## üìä –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:

### –í —Å–ª—É—á–∞–µ —É—Å–ø–µ—Ö–∞:
```json
{
  "imageUrl": "https://s3.twcstorage.ru/bucket/teadragonimages/1234567890-image.jpg",
  "success": true
}
```

### –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏:
```json
{
  "error": "–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: InvalidAccessKeyId",
  "details": {
    "message": "UnknownError",
    "name": "InvalidAccessKeyId",
    "code": "InvalidAccessKeyId",
    "statusCode": 403
  },
  "hint": "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ S3_ACCESS_KEY –∏ S3_SECRET_KEY –≤ Vercel Environment Variables"
}
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏:

- [ ] –í—Å–µ S3 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ Vercel
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∫–æ –≤—Å–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏—è–º
- [ ] –°–¥–µ–ª–∞–Ω Redeploy –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [ ] –û—Ç–∫—Ä—ã—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ `/test-upload`
- [ ] –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ª–æ–≥–∏ –≤ Vercel
- [ ] –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –∫–æ–¥ –æ—à–∏–±–∫–∏

---

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç:

1. –û—Ç–∫—Ä–æ–π—Ç–µ `/test-upload` –Ω–∞ –≤–∞—à–µ–º —Å–∞–π—Ç–µ
2. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
4. –û—Ç–∫—Ä–æ–π—Ç–µ Vercel ‚Üí Functions ‚Üí –õ–æ–≥–∏
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏ –∏–∑ `/api/upload`
6. –ü—Ä–∏—à–ª–∏—Ç–µ –º–Ω–µ –æ–±–∞ —Ç–µ–∫—Å—Ç–∞

---

## üéØ –ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏:

1. –£–¥–∞–ª–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É:
   ```bash
   rm -rf app/test-upload
   ```

2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–≥—Ä—É–∑–∫—É –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

3. –í—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!

---

**–£–¥–∞—á–∏ —Å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–æ–π! üöÄ**
